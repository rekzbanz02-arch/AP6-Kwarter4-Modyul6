<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üåç AP Quiz for Kids!</title>
  <!-- Google Fonts - Playful fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Bubblegum+Sans&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Bubblegum Sans', 'Fredoka', cursive;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #2d3748;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 25px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      padding: 40px 30px;
      text-align: center;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: pulse 4s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .emoji-banner {
      font-size: 3.5em;
      margin-bottom: 15px;
      animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
      font-weight: 700;
      font-family: 'Bubblegum Sans', 'Fredoka', cursive;
    }

    .header .emoji {
      font-size: 3em;
    }

    .content {
      padding: 30px;
    }

    /* Login Section Styles */
    #accessSection {
      text-align: center;
    }

    #fileDisplay {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 20px;
      color: #667eea;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      animation: bounce 2s ease-in-out infinite;
    }

    #accessSection h2 {
      font-size: 1.5em;
      color: #4a5568;
      margin-bottom: 20px;
      font-family: 'Fredoka', cursive;
    }

    .password-container {
      position: relative;
      display: inline-block;
      margin-bottom: 20px;
    }

    #codeInput {
      font-size: 18px;
      padding: 15px 50px 15px 20px;
      width: 300px;
      border-radius: 15px;
      border: 3px solid #667eea;
      font-family: 'Fredoka', cursive;
      transition: all 0.3s;
    }

    #codeInput:focus {
      outline: none;
      border-color: #f5576c;
      box-shadow: 0 0 15px rgba(245, 87, 108, 0.3);
    }

    #toggleEye {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 24px;
      user-select: none;
      transition: transform 0.3s ease;
    }

    #toggleEye:hover {
      transform: translateY(-50%) scale(1.2);
    }

    .btn {
      padding: 15px 40px;
      font-size: 20px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      margin: 10px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      font-family: 'Bubblegum Sans', 'Fredoka', cursive;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
    }

    .btn-warning {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      color: #2d3748;
    }

    #contactLink {
      display: inline-block;
      margin-top: 10px;
      color: #667eea;
      text-decoration: underline;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    #contactLink:hover {
      color: #f5576c;
      transform: scale(1.05);
    }

    #message {
      margin-top: 15px;
      font-size: 16px;
      font-weight: bold;
      color: #e53e3e;
    }

    #tipsArea {
      margin-top: 25px;
      padding: 20px;
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      border-radius: 15px;
      font-size: 15px;
      line-height: 1.6;
      color: #2d3748;
      text-align: left;
    }

    /* Main Content Styles */
    #mainContent h1 {
      font-size: 2.2em;
      color: #667eea;
      margin-bottom: 20px;
      text-align: center;
      font-family: 'Bubblegum Sans', 'Fredoka', cursive;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Reviewer Section */
    .reviewer details {
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      margin-bottom: 15px;
      border-radius: 15px;
      overflow: hidden;
      border: 4px solid transparent;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      position: relative;
    }

    .reviewer details::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .reviewer details:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      border-color: #667eea;
    }

    .reviewer details:hover::before {
      opacity: 1;
    }

    .reviewer summary {
      padding: 20px;
      font-size: 1.3em;
      font-weight: bold;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.5);
      transition: all 0.3s;
      color: #2d3748;
      position: relative;
      z-index: 1;
    }

    .reviewer summary:hover {
      background: rgba(255, 255, 255, 0.8);
    }

    .reviewer ul {
      padding: 20px 40px;
      list-style-type: none;
    }

    .reviewer li {
      padding: 10px 0;
      font-size: 1.1em;
      line-height: 1.6;
      position: relative;
      padding-left: 30px;
    }

    .reviewer li::before {
      content: "üåü";
      position: absolute;
      left: 0;
      font-size: 1.2em;
    }

    .reviewer strong {
      color: #667eea;
    }

    /* Quiz Section */
    .question {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      padding: 25px;
      margin-bottom: 20px;
      border-radius: 15px;
      border: 3px solid #f5576c;
    }

    .question p {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 15px;
      color: #2d3748;
    }

    .question label {
      display: block;
      padding: 12px;
      margin: 8px 0;
      background: white;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1.1em;
    }

    .question label:hover {
      background: #fed6e3;
      transform: translateX(5px);
    }

    input[type="radio"] {
      transform: scale(1.5);
      margin-right: 15px;
      cursor: pointer;
    }

    .correct {
      color: #38a169;
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 10px;
    }

    .wrong {
      color: #e53e3e;
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 10px;
    }

    .correct::before {
      content: "‚ú® ";
    }

    .wrong::before {
      content: "üí° ";
    }

    #result {
      text-align: center;
      padding: 30px;
      background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
      border-radius: 15px;
      margin-top: 20px;
    }

    #result h2 {
      font-size: 2.5em;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .nav-buttons {
      margin-top: 25px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    #finishBtn {
      font-size: 2em;
      padding: 20px 50px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    /* Contact Modal */
    #contactModalBG {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    #contactModal {
      background: white;
      width: 90%;
      max-width: 500px;
      margin: 80px auto;
      padding: 35px;
      border-radius: 25px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    #contactModal h2 {
      margin-top: 0;
      font-size: 1.8em;
      text-align: center;
      color: #667eea;
      margin-bottom: 25px;
    }

    #contactModal label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #4a5568;
      font-size: 1.1em;
    }

    #contactModal input,
    #contactModal textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 2px solid #cbd5e0;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'Fredoka', cursive;
      transition: all 0.3s;
    }

    #contactModal input:focus,
    #contactModal textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
    }

    #contactModal textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }

      #codeInput {
        width: 100%;
        max-width: 300px;
      }

      .content {
        padding: 20px;
      }

      .nav-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="emoji-banner">üåç üî¨ ‚öóÔ∏è</div>
        <h1>AP Adventure!</h1>
      </div>
    </div>

    <div class="content">
      <div id="accessSection">
        <p id="fileDisplay"></p>
        <h2>üîê Enter Access Code: '12345'</h2>
        
        <div class="password-container">
          <input type="password" id="codeInput" placeholder="Type your code here...">
          <span id="toggleEye">üëÅÔ∏è</span>
        </div>
        
        <br>
        <button type="button" id="accessSubmit" class="btn btn-primary">Login</button>

        <div>
          <span id="contactLink">üìß Need Help? Contact Us!</span>
        </div>

        <p id="message" aria-live="polite"></p>
        <div id="tipsArea">Loading tips...</div>
      </div>

      <div id="mainContent" style="display:none;">
        <div id="reviewerSection">
          <h1>üåü AP 6 Reviewer üåü<br>(Kwarter 4, Modyul 6)</h1>
     
          <section class="reviewer">
            <!-- ==================== START OF REVIEWER ==================== -->
            <details>
<summary>üìå Pangunahing Paksa at Ideya</summary>
<ul>
  <li>Mahalaga ang ginagampanang papel ng bawat mamamayan sa kaunlaran ng bansa.</li>
  <li>Ang pagtangkilik sa sariling produkto ay nakatutulong sa ekonomiya.</li>
  <li>Ang pagpapabuti ng kalakal at paglilingkod ay nagpapalakas sa kabuhayan.</li>
  <li>Ang pagtitipid sa enerhiya ay may direktang kaugnayan sa pag-unlad ng bansa.</li>
</ul>
</details>

<details>
<summary>üìå Mahahalagang Kahulugan</summary>
<ul>
  <li><strong>Pagtangkilik sa sariling produkto</strong> ‚Äì Pagbili at paggamit ng mga produktong gawa sa Pilipinas.</li>
  <li><strong>Kalakal</strong> ‚Äì Mga produktong binibili ng mamamayan tulad ng pagkain, gamot, damit, at iba pa.</li>
  <li><strong>Paglilingkod</strong> ‚Äì Serbisyong ibinibigay ng tao sa kapwa at lipunan.</li>
  <li><strong>Enerhiya</strong> ‚Äì Lakas na ginagamit sa pagpapatakbo ng makina, kuryente, tubig, langis, hangin, at sikat ng araw.</li>
</ul>
</details>

<details>
<summary>üìå Mahahalagang Detalye at Katotohanan</summary>
<ul>
  <li>Ang dolyar ang ginagamit sa pag-aangkat ng produkto mula sa ibang bansa.</li>
  <li>Kapag tinangkilik ang produktong Pilipino, tumataas ang produksyon at hanapbuhay.</li>
  <li>Ang mataas na kalidad ng kalakal ay mas madaling tangkilikin.</li>
  <li>Ang enerhiya ay nauubos kaya dapat itong gamitin nang wasto.</li>
</ul>
</details>

<details>
<summary>üìå Paraan ng Pagpapaunlad ng Bansa</summary>
<ul>
  <li>Pagkakaroon ng manggagawang may mataas na kasanayan.</li>
  <li>Tuloy-tuloy na pagtuklas ng bagong paraan ng paggawa.</li>
  <li>Pagpapakadalubhasa dito man o sa ibang bansa.</li>
  <li>Wastong paggamit ng kalakal at paglilingkod.</li>
  <li>Pagtitipid sa kuryente, tubig, at langis.</li>
</ul>
</details>

<details>
<summary>üìå Posibleng Lumabas sa Pagsusulit (Tanong at Sagot)</summary>
<ul>
  <li><strong>Tanong:</strong> Ano ang gamit sa pag-aangkat ng produkto mula sa ibang bansa?<br>
      <strong>Sagot:</strong> Dolyar</li>
  <li><strong>Tanong:</strong> Ano ang tawag sa produktong binibili ng mamamayan?<br>
      <strong>Sagot:</strong> Kalakal</li>
  <li><strong>Tanong:</strong> Bakit mahalaga ang pagtitipid sa enerhiya?<br>
      <strong>Sagot:</strong> Dahil nakatutulong ito sa pag-unlad ng bansa</li>
</ul>
</details>
          </section>
     
          <button onclick="showQuiz()" class="btn btn-success">üéØ Start Quiz!</button>
        </div>

        <div id="quizSection" style="display:none;">
          <h1>üìù Quiz Time! üìù<br>AP 6 - Kwarter 4, Modyul 6</h1>
          <p style="font-size: 18px; font-weight: 600; margin: 0 0 20px 0; text-align: center; color: #667eea;">
            Multiple-Choice Quiz (random items)
          </p>
          <form id="quizForm"></form>

          <div class="nav-buttons">
            <button id="finishBtn" class="btn">üèÜ Get Score</button>
            <button type="button" onclick="refreshQuiz()" class="btn btn-warning">üîÑ Restart Quiz</button>
            <button type="button" onclick="backToReviewer()" class="btn btn-primary">üìö Back to Review</button>
          </div>
          <div id="result"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CONTACT POPUP MODAL -->
  <div id="contactModalBG">
    <div id="contactModal">
      <h2>üì¨ Contact Form</h2>
      <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">
        Fill in your details and we'll contact you soon!
      </p>

      <label>üë§ Name:</label>
      <input id="c_name" type="text">

      <label>üì± Contact No.:</label>
      <input id="c_contact" type="text">

      <label>üí¨ Social Media Account:</label>
      <input id="c_social" type="text">

      <label>‚úâÔ∏è Request / Comment:</label>
      <textarea id="c_request"></textarea>

      <button id="c_submit" class="btn btn-success" style="width: 100%;">Send Message</button>
      <button id="c_close" class="btn" style="width: 100%; background: #718096;">Close</button>
    </div>
  </div>

  <script>
    // ==================== GOOGLE APPS SCRIPT CONFIGURATION ====================
    // IMPORTANT: Replace this URL with your deployed Google Apps Script web app URL
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxDvvheKuMWsJiQ0hKdQt8V3WX6gyoMwngNQvis3JJS24I8StyiT7U8L2alwiOtJKb7/exec";
    // After deploying the Apps Script, paste the web app URL above

    // ==================== HELPER FUNCTIONS ====================
    document.addEventListener("DOMContentLoaded", () => {
      // ===== SHOW / HIDE PASSWORD TOGGLE =====
      const toggleEye = document.getElementById("toggleEye");
      const codeInputEye = document.getElementById("codeInput");

      toggleEye.addEventListener("click", () => {
        if (codeInputEye.type === "password") {
          codeInputEye.type = "text";
          toggleEye.textContent = "üôà";
        } else {
          codeInputEye.type = "password";
          toggleEye.textContent = "üëÅÔ∏è";
        }
      });

      // ===== Display filename on login page =====
      const quizTitleEl = document.querySelector("#quizSection h1");
      const displayFileName = quizTitleEl ? quizTitleEl.textContent.replace("Quiz Time! üìù", "").replace("üìù", "").trim() : "Science Grade 6";
      const fileDisplay = document.getElementById("fileDisplay");
      if (fileDisplay) fileDisplay.textContent = displayFileName;

      // ===== ELEMENTS =====
      const accessSection = document.getElementById("accessSection");
      const mainContent = document.getElementById("mainContent");
      const codeInput = document.getElementById("codeInput");
      const accessSubmit = document.getElementById("accessSubmit");
      const message = document.getElementById("message");
      const tipsArea = document.getElementById("tipsArea");

      // ===============================
      // CONTACT MODAL LOGIC
      // ===============================
      const contactLink = document.getElementById("contactLink");
      const contactBG = document.getElementById("contactModalBG");
      const contactClose = document.getElementById("c_close");
      const contactSubmit = document.getElementById("c_submit");

      if (contactLink && contactBG) {
        contactLink.addEventListener("click", () => {
          contactBG.style.display = "block";
        });
      }

      if (contactClose && contactBG) {
        contactClose.addEventListener("click", () => {
          contactBG.style.display = "none";
        });
      }

      // ===============================
      // CONTACT SUBMISSION LOGIC
      // ===============================
      if (contactSubmit) {
        contactSubmit.addEventListener("click", async () => {
          const name = document.getElementById("c_name").value.trim();
          const contact = document.getElementById("c_contact").value.trim();
          const social = document.getElementById("c_social").value.trim();
          const request = document.getElementById("c_request").value.trim();

          if (!name || !contact || !request) {
            alert("Please fill out name, contact, and request/comment.");
            return;
          }

          const quizTitleElLocal = document.querySelector("#quizSection h1");
          const fileName = quizTitleElLocal
            ? quizTitleElLocal.textContent.replace("Quiz Time! üìù", "").replace("üìù", "").trim()
            : "Science Grade 6";

          const deviceInfo = await getDeviceInfo();

          try {
            contactSubmit.disabled = true;
            contactSubmit.innerHTML = '<span class="loading"></span> Sending...';

            await fetch(GOOGLE_SCRIPT_URL, {
              method: "POST",
              redirect: 'follow',
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: JSON.stringify({
                action: "saveContact",
                data: {
                  event: "Client Request",
                  request,
                  name,
                  contact,
                  social,
                  filename: fileName,
                  timestamp: new Date().toLocaleString(),
                  device: deviceInfo
                }
              })
            });

            alert("‚úÖ Message sent successfully!");
            contactBG.style.display = "none";
            
            // Clear form
            document.getElementById("c_name").value = "";
            document.getElementById("c_contact").value = "";
            document.getElementById("c_social").value = "";
            document.getElementById("c_request").value = "";

          } catch (err) {
            alert("‚ùå Error sending message. Please try again.");
            console.error(err);
          } finally {
            contactSubmit.disabled = false;
            contactSubmit.textContent = "Send Message";
          }
        });
      }

      // ===== DEVICE INFO HELPER =====
      async function getDeviceInfo() {
        const uaData = navigator.userAgentData || {};
        const ua = navigator.userAgent;
        const platform = navigator.platform;
        const language = navigator.language;
        const screenResolution = `${window.screen.width}x${window.screen.height}`;
        const browserVersion = uaData.brands
          ? uaData.brands.map(b => `${b.brand} ${b.version}`).join(", ")
          : ua;

        const uaLower = ua.toLowerCase();
        let deviceType = "desktop";
        if (/mobi|iphone|android/i.test(uaLower)) {
          deviceType = "mobile";
        } else if (/tablet|ipad|nexus 7|nexus 10/i.test(uaLower)) {
          deviceType = "tablet";
        }

        let networkInfo = "Unavailable";
        try {
          const res = await fetch("https://ipapi.co/json/");
          if (res.ok) {
            const info = await res.json();
            networkInfo = {
              ip: info.ip,
              city: info.city,
              region: info.region,
              country: info.country_name,
              org: info.org
            };
          }
        } catch {
          networkInfo = "Network lookup failed";
        }

        return {
          ua,
          browserVersion,
          platform,
          language,
          screenResolution,
          deviceType,
          networkInfo
        };
      }

      // ===== SAVE LOGIN TO GOOGLE SHEETS =====
      async function saveLoginToGoogleSheets(codeUsed) {
        try {
          const quizTitleElLocal = document.querySelector("#quizSection h1");
          const fileName = quizTitleElLocal 
            ? quizTitleElLocal.textContent.replace("Quiz Time! üìù", "").replace("üìù", "").trim() 
            : "Science Grade 6";

          const deviceInfo = await getDeviceInfo();

          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            redirect: 'follow',
            headers: { 
              "Content-Type": "application/x-www-form-urlencoded"
            },
            body: JSON.stringify({
              action: "saveLogin",
              data: {
                event: "Login Access",
                accessCode: codeUsed,
                filename: fileName,
                timestamp: new Date().toLocaleString(),
                device: deviceInfo
              }
            })
          });

          console.log(`‚úÖ Login logged successfully (file: ${fileName}).`);
        } catch (err) {
          console.error("‚ùå Error logging to Google Sheets:", err);
          // Don't show error to user - logging is not critical
        }
      }

      // ===== LOAD TIPS FROM GOOGLE SHEETS =====
      async function loadTips() {
        try {
          // First check if URL is configured
          if (GOOGLE_SCRIPT_URL === "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE") {
            tipsArea.innerHTML = 
              "‚ö†Ô∏è <strong>Configuration Required:</strong><br>" +
              "Please set up your Google Apps Script URL in the HTML file.<br>" +
              "See SETUP_GUIDE.md for instructions.";
            return;
          }

          const resp = await fetch(`${GOOGLE_SCRIPT_URL}?action=getTips`, {
            method: 'GET',
            redirect: 'follow'
          });
          
          if (!resp.ok) {
            throw new Error(`HTTP error! status: ${resp.status}`);
          }
          
          const data = await resp.json();
          
          if (data.error) {
            throw new Error(data.error);
          }
          
          const tipsText = data.tips || 
            "üí° <strong>Tips:</strong><br>" +
            "‚úÖ Press Enter after typing the code.<br>" +
            "‚úÖ Stay online when entering.<br>" +
            "‚úÖ For help, contact: @Rekz Banz";
          
          tipsArea.innerHTML = tipsText;
        } catch (err) {
          console.error("Tips fetch error:", err);
          tipsArea.innerHTML = 
            "‚ö†Ô∏è <strong>Connection Error:</strong><br>" +
            "Could not connect to Google Sheets.<br>" +
            `Error: ${err.message}<br>` +
            "Please check:<br>" +
            "1. Google Script URL is correct<br>" +
            "2. Script is deployed as Web App<br>" +
            "3. Access is set to 'Anyone'";
        }
      }
      loadTips();

      // ===== SAVE QUIZ SCORE TO GOOGLE SHEETS =====
      async function saveScoreToGoogleSheets(score, total) {
        try {
          const quizTitleElLocal = document.querySelector("#quizSection h1");
          const fileName = quizTitleElLocal 
            ? quizTitleElLocal.textContent.replace("Quiz Time! üìù", "").replace("üìù", "").trim() 
            : "Science Grade 6";

          const deviceInfo = await getDeviceInfo();

          await fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            redirect: 'follow',
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: JSON.stringify({
              action: "saveScore",
              data: {
                event: "Quiz Score",
                score: `${score}/${total}`,
                filename: fileName,
                timestamp: new Date().toLocaleString(),
                device: deviceInfo
              }
            })
          });

          console.log("‚úÖ Quiz score saved to Google Sheets successfully.");
        } catch (err) {
          console.error("‚ùå Error saving quiz score:", err);
          // Don't show error to user - logging is not critical
        }
      }

      // ===== LOCAL STORAGE =====
      const fileName = window.location.pathname.split("/").pop() || "default";
      const storageKey = "savedAccessCode_" + fileName.replace(/\W+/g, "_");
      const savedCode = localStorage.getItem(storageKey);
      if (savedCode) codeInput.value = savedCode;
      codeInput.addEventListener("input", () =>
        localStorage.setItem(storageKey, codeInput.value)
      );

      // ===== LOGIN HANDLER =====
      codeInput.addEventListener("keyup", (e) => {
        if (e.key === "Enter") accessSubmit.click();
      });

      accessSubmit.addEventListener("click", async () => {
        const input = codeInput.value.trim();
        if (!input) {
          message.textContent = "‚ö†Ô∏è Please enter the access code.";
          return;
        }

        // Check if URL is configured
        if (GOOGLE_SCRIPT_URL === "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE") {
          message.innerHTML = "‚ö†Ô∏è <strong>Setup Required:</strong><br>Google Apps Script URL not configured. See SETUP_GUIDE.md";
          return;
        }

        accessSubmit.disabled = true;
        codeInput.disabled = true;
        message.innerHTML = '<span class="loading"></span> Checking...';

        try {
          console.log('Fetching access code from:', GOOGLE_SCRIPT_URL);
          
          const resp = await fetch(`${GOOGLE_SCRIPT_URL}?action=getAccessCode`, {
            method: 'GET',
            redirect: 'follow'
          });
          
          console.log('Response status:', resp.status);
          
          if (!resp.ok) {
            throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);
          }
          
          const data = await resp.json();
          console.log('Response data:', data);

          if (data.error) {
            throw new Error(data.error);
          }

          const remoteCode = data.accessCode;

          if (!remoteCode) {
            message.innerHTML = "‚ùå Access code not found in Google Sheets.<br>Please check the AccessCode sheet.";
            throw new Error("No accessCode in response");
          }

          if (input === String(remoteCode).trim()) {
            accessSection.style.display = "none";
            mainContent.style.display = "block";
            message.textContent = "";
            saveLoginToGoogleSheets(input);
            setTimeout(() => {
              const btn = document.querySelector("#mainContent button");
              if (btn) btn.focus();
            }, 100);
          } else {
            message.innerHTML = `‚ùå Wrong code. Entered: "${input}"<br>Please contact support.`;
            localStorage.removeItem(storageKey);
            accessSubmit.disabled = false;
            codeInput.disabled = false;
          }
        } catch (err) {
          console.error("Access fetch error:", err);
          message.innerHTML = 
            `‚ùå <strong>Connection Error:</strong><br>` +
            `${err.message}<br>` +
            `Please verify:<br>` +
            `1. Google Script URL is correct<br>` +
            `2. Script is deployed as Web App<br>` +
            `3. Access permission is 'Anyone'`;
          accessSubmit.disabled = false;
          codeInput.disabled = false;
        }
      });

      // ===== QUIZ LOGIC =====
      const pool = [
        
        


{q: "Ano ang ginagamit sa pag-aangkat ng mga produkto mula sa ibang bansa?", 
choices: ["Piso", "Yen", "Euro", "Dolyar", "Salapi", "Ginto"], 
correctIndex: 3},

{q: "Ano ang ipinakikita ng mamamayang tumatangkilik sa produktong Pilipino?", 
choices: ["Pagiging maluho", "Pagiging matipid", "Pagiging makabayan", "Pagiging dayuhan", "Pagiging negosyante", "Pagiging mapili"], 
correctIndex: 2},

{q: "Ano ang tawag sa mga produktong binibili ng mamamayan tulad ng pagkain at damit?", 
choices: ["Paglilingkod", "Enerhiya", "Kalakal", "Industriya", "Serbisyo", "Produksyon"], 
correctIndex: 2},

{q: "Ano ang tawag sa serbisyong ibinibigay ng guro, doktor, at tsuper?", 
choices: ["Kalakal", "Produksyon", "Paglilingkod", "Industriya", "Enerhiya", "Pamilihan"], 
correctIndex: 2},

{q: "Ano ang nagiging bunga kapag mataas ang produksyon sa bansa?", 
choices: ["Pagtaas ng presyo", "Kakulangan sa trabaho", "Mas maraming hanapbuhay", "Pagdami ng inaangkat", "Pagbaba ng kita", "Pagkalugi"], 
correctIndex: 2},

{q: "Alin ang HINDI halimbawa ng enerhiya?", 
choices: ["Tubig", "Kuryente", "Langis", "Hangin", "Sikat ng araw", "Damit"], 
correctIndex: 5},

{q: "Bakit mahalaga ang pagtitipid sa enerhiya?", 
choices: ["Dahil uso ito", "Dahil nakababawas ng trabaho", "Dahil nakatutulong sa kaunlaran ng bansa", "Dahil nagpapataas ng presyo", "Dahil nauuso sa ibang bansa", "Dahil madali itong gawin"], 
correctIndex: 2},

{q: "Ano ang maaaring mangyari kung hindi magtitipid sa enerhiya?", 
choices: ["Bumababa ang presyo", "Tataas ang produksyon", "Magiging sapat ang langis", "Tataas ang presyo at bababa ang produksyon", "Dadami ang trabaho", "Bibilis ang serbisyo"], 
correctIndex: 3},

{q: "Ano ang tawag sa serbisyong ibinibigay sa lipunan?", 
choices: ["Kalakal", "Paglilingkod", "Produksyon", "Enerhiya", "Industriya", "Pamilihan"], 
correctIndex: 1},

{q: "Ano ang dapat gawin sa kagamitang de-kuryente matapos gamitin?", 
choices: ["Iwanang bukas", "Ayusin", "Linisin lamang", "Isara", "Palitan", "Ibenta"], 
correctIndex: 3},

{q: "Alin ang tamang paraan ng pagtitipid sa enerhiya?", 
choices: ["Iwanang bukas ang ilaw", "Madalas na pagbukas ng refrigerator", "Patayin ang electric fan pagkatapos gamitin", "Pagpapatakbo ng sasakyan kahit malapit lang", "Pag-aaksaya ng tubig", "Pagbukas-sara ng kalan"], 
correctIndex: 2},

{q: "Ano ang pangunahing layunin ng pagtangkilik sa sariling produkto?", 
choices: ["Pagpapayaman ng dayuhan", "Pagbaba ng produksyon", "Pag-unlad ng bansa", "Pagdami ng imported", "Pagtaas ng dolyar", "Pagbaba ng hanapbuhay"], 
correctIndex: 2},

{q: "Ano ang tawag sa mga produktong gawa sa Pilipinas?", 
choices: ["Imported", "Dayuhan", "Lokal", "Ipinagbabawal", "Ilegal", "Ipinuslit"], 
correctIndex: 2},

{q: "Ano ang papel ng mamimili sa kaunlaran ng bansa?", 
choices: ["Walang epekto", "Pag-aangkat lamang", "Pagtangkilik sa sariling produkto", "Pagbili ng imported", "Pag-iwas sa lokal", "Pagpapataas ng presyo"], 
correctIndex: 2},

{q: "Ano ang dapat gawin kung may problema sa kalakal o serbisyo?", 
choices: ["Balewalain", "Itago", "Iulat", "Iwasan", "Sirain", "Ibenta"], 
correctIndex: 2},

{q: "Ano ang tawag sa lakas na ginagamit sa pagpapatakbo ng makina?", 
choices: ["Produksyon", "Kalakal", "Enerhiya", "Paglilingkod", "Industriya", "Pamilihan"], 
correctIndex: 2},

{q: "Ano ang epekto ng magandang kalidad ng produkto?", 
choices: ["Hindi tinatangkilik", "Mas mahal", "Mas madaling tangkilikin", "Hindi nabibili", "Mas madaling masira", "Mas kaunti ang mamimili"], 
correctIndex: 2},

{q: "Ano ang dapat isaalang-alang sa wastong paggamit ng kalakal?", 
choices: ["Pag-aaksaya", "Karapatan at tungkulin ng mamimili", "Pagbili ng imported", "Pagtaas ng presyo", "Pag-iimbak", "Pagpapabaya"], 
correctIndex: 1},

{q: "Ano ang epekto ng pagtangkilik sa produktong Pilipino?", 
choices: ["Pagbaba ng kita", "Pagdami ng inaangkat", "Pagtaas ng hanapbuhay", "Pagbaba ng produksyon", "Pagkalugi", "Pagtaas ng utang"], 
correctIndex: 2},

{q: "Ano ang dapat gawin kapag malapit lang ang pupuntahan?", 
choices: ["Sumakay ng sasakyan", "Maglakad", "Magpatakbo ng motorsiklo", "Mag-jeep", "Mag-tricycle", "Mag-taxi"], 
correctIndex: 1},

{q: "Ano ang halimbawa ng pagtitipid sa tubig?", 
choices: ["Pag-aaksaya", "Pagpapatulo ng gripo", "Paggamit muli ng tubig-banlaw", "Pagbabad ng matagal", "Pagbukas ng gripo magdamag", "Pag-iwan ng hose"], 
correctIndex: 2},

{q: "Ano ang layunin ng pagpapabuti ng kalakal at paglilingkod?", 
choices: ["Pagbagsak ng ekonomiya", "Pag-unlad ng kabuhayan", "Pagtaas ng imported", "Pagbaba ng kalidad", "Pagkalugi", "Pagbawas ng manggagawa"], 
correctIndex: 1},

{q: "Ano ang tawag sa serbisyong kasiya-siya at maayos?", 
choices: ["Hindi tinatangkilik", "Balewala", "Pinagkakatiwalaan", "Ipinagbabawal", "Iniiwasan", "Ipinagpapaliban"], 
correctIndex: 2},

{q: "Ano ang papel ng bawat mamamayan sa bansa?", 
choices: ["Walang tungkulin", "Manood lamang", "Makibahagi sa kaunlaran", "Umasa sa iba", "Umiwas sa responsibilidad", "Maghintay"], 
correctIndex: 2},

{q: "Ano ang epekto ng pagtitipid sa langis?", 
choices: ["Pagtaas ng inaangkat", "Pagbaba ng produksyon", "Pagbawas ng pag-aangkat", "Pagtaas ng presyo", "Pagkalugi", "Pagbagal ng ekonomiya"], 
correctIndex: 2},

{q: "Ano ang halimbawa ng maling paggamit ng enerhiya?", 
choices: ["Pagpatay ng ilaw", "Paglakad kung malapit", "Pag-iwan ng ilaw na bukas", "Paghahanda bago magluto", "Pagsara ng appliances", "Paglilinis ng bentilador"], 
correctIndex: 2},

{q: "Ano ang tawag sa produktong galing sa ibang bansa?", 
choices: ["Lokal", "Pilipino", "Imported", "Sariling atin", "Katulong", "Pambansa"], 
correctIndex: 2},

{q: "Ano ang layunin ng pagtitipid sa enerhiya?", 
choices: ["Pag-aaksaya", "Pagkalugi", "Pag-unlad ng bansa", "Pagtaas ng konsumo", "Pagdami ng problema", "Pagbaba ng produksyon"], 
correctIndex: 2},

{q: "Ano ang dapat gawin ng mamimili upang makatulong sa bansa?", 
choices: ["Bumili ng imported", "Mag-aksaya", "Magtangkilik ng lokal", "Umiwas sa produkto", "Maghintay", "Magreklamo lamang"], 
correctIndex: 2}
        
        
        
        
      ];

      // === UPDATE QUIZ TITLE (selected/total items) ===
      function updateQuizTitleCount(selectedCount) {
        const quizTitleEl = document.querySelector("#quizSection h1");
        if (quizTitleEl) {
          const totalItems = pool.filter(item => item && item.q && item.choices).length;
          quizTitleEl.innerHTML = `üìù Quiz Time! üìù<br>AP 6 - Kwarter 4, Modyul 6<br><span style="font-size: 0.7em; color: #667eea;">(${selectedCount}/${totalItems} items)</span>`;
        }
      }

      function pickRandom(arr, n) {
        const copy = [...arr];
        const result = [];
        while (result.length < n && copy.length > 0) {
          const idx = Math.floor(Math.random() * copy.length);
          result.push(copy.splice(idx, 1)[0]);
        }
        return result;
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function selectRandomChoices(item) {
        const correctChoice = item.choices[item.correctIndex];
        let others = item.choices.filter((_, idx) => idx !== item.correctIndex);
        shuffleArray(others);
        let selected = [correctChoice, ...others.slice(0, 4)];
        shuffleArray(selected);
        item.correctIndex = selected.indexOf(correctChoice);
        item.choices = selected;
      }

      let quizItems = [];

      window.showQuiz = function () {
        document.getElementById("reviewerSection").style.display = "none";
        document.getElementById("quizSection").style.display = "block";
        buildQuiz();
      };

      window.backToReviewer = function () {
        document.getElementById("quizSection").style.display = "none";
        document.getElementById("reviewerSection").style.display = "block";
        document.getElementById("quizForm").innerHTML = "";
        document.getElementById("result").innerHTML = "";
      };

      window.refreshQuiz = function () {
        document.getElementById("quizForm").innerHTML = "";
        document.getElementById("result").innerHTML = "";
        document.getElementById("finishBtn").disabled = false;
        buildQuiz();
      };

      function buildQuiz() {
        quizItems = pickRandom(pool, Math.min(10, pool.length));
        const form = document.getElementById("quizForm");
        form.innerHTML = "";
        quizItems.forEach((item, i) => {
          selectRandomChoices(item);
          const div = document.createElement("div");
          div.className = "question";
          const q = document.createElement("p");
          q.textContent = `${i + 1}. ${item.q}`;
          div.appendChild(q);
          item.choices.forEach((choice, idx) => {
            const label = document.createElement("label");
            const radio = document.createElement("input");
            radio.type = "radio";
            radio.name = `q${i}`;
            radio.value = idx;
            label.appendChild(radio);
            label.appendChild(document.createTextNode(" " + choice));
            div.appendChild(label);
            div.appendChild(document.createElement("br"));
          });
          form.appendChild(div);
        });
        updateQuizTitleCount(quizItems.length);
      }

      document.getElementById("finishBtn").addEventListener("click", async function () {
        let score = 0;
        const total = quizItems.length;
        for (let i = 0; i < total; i++) {
          const radios = document.querySelectorAll(`input[name="q${i}"]`);
          let selected = -1;
          radios.forEach(r => { if (r.checked) selected = parseInt(r.value); });
          const div = document.getElementById("quizForm").children[i];
          if (selected === quizItems[i].correctIndex) {
            score++;
            div.insertAdjacentHTML("beforeend", "<div class='correct'>‚úî Correct! Great job!</div>");
          } else {
            const correctAnswer = quizItems[i].choices[quizItems[i].correctIndex];
            div.insertAdjacentHTML("beforeend", `<div class='wrong'>‚úò Oops! The answer is: ${correctAnswer}</div>`);
          }
          radios.forEach(r => r.disabled = true);
        }
        
        const percentage = Math.round((score / total) * 100);
        let emoji = "üéâ";
        if (percentage === 100) emoji = "üèÜ";
        else if (percentage >= 80) emoji = "‚≠ê";
        else if (percentage >= 60) emoji = "üëç";
        else emoji = "üí™";
        
        document.getElementById("result").innerHTML = 
          `<h2>${emoji} Your Score: ${score} / ${total} ${emoji}</h2>
           <p style="font-size: 1.5em; margin-top: 10px;">${percentage}% Correct!</p>`;
        this.disabled = true;

        // Save score to Google Sheets
        await saveScoreToGoogleSheets(score, total);
      });
    });
  </script>
</body>
</html>
